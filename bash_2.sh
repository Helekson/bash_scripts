#!/bin/bash

# Функция для вывода инструкции по использованию
print_help() {
  echo "Использование: $0 [-d каталог] [-e файл_ошибок] файл1 файл2 ..."
  echo "  -d каталог     Указать каталог, в котором искать файлы (по умолчанию текущий каталог)."
  echo "  -e файл_ошибок Перенаправить сообщения об ошибках в указанный файл."
  echo "  -h             Показать эту инструкцию."
}

# Функция для подсчета строк в файле
count_lines() {
  local file=$1
  if [[ -f "$file" ]]; then
    lines=$(wc -l < "$file")
    echo "Файл: $file - Строк: $lines"
  else
    echo "Ошибка: Файл $file не найден." >&2
  fi
}

# Обработчик аргументов
directory="."
error_file=""
while getopts "d:e:h" opt; do
  case "$opt" in
    d) # Обработка ключа -d для указания каталога
      directory="$OPTARG"
      ;;
    e) # Обработка ключа -e для указания файла ошибок
      error_file="$OPTARG"
      ;;
    h) # Обработка ключа -h для вывода инструкции
      print_help
      exit 0
      ;;
    *)
      echo "Неверный параметр. Используйте -h для справки." >&2
      exit 1
      ;;
  esac
done

# Перенаправление ошибок в файл, если указан ключ -e
if [[ -n "$error_file" ]]; then
  exec 2>"$error_file"
fi

# Проверка, что переданы файлы для подсчета строк
shift $((OPTIND - 1))
if [[ $# -eq 0 ]]; then
  echo "Ошибка: Не переданы файлы для подсчета строк." >&2
  print_help
  exit 1
fi

# Переход в указанный каталог
cd "$directory" || { echo "Ошибка: Не удалось перейти в каталог $directory." >&2; exit 1; }

# Подсчет строк в переданных файлах
for file in "$@"; do
  count_lines "$file"
done

